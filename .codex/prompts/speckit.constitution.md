---
description: 从交互式或提供的原则输入创建或更新项目宪法，并确保所有依赖模板保持同步。
handoffs: 
  - label: 构建规范
    agent: speckit.specify
    prompt: 基于更新后的宪法实现功能规范。我想构建...
---

## 用户输入

```text
$ARGUMENTS
```

在继续之前你**必须**先考虑用户输入（如果不为空）。

## 大纲

你正在更新项目宪法，文件路径为 `.specify/memory/constitution.md`。该文件是一个包含方括号占位符（如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）的模板。你的工作是：(a) 收集/推导具体值，(b) 精确填充模板，(c) 将任何修订同步到依赖工件中。

按以下流程执行：

1. 加载现有宪法模板 `.specify/memory/constitution.md`。
   - 识别所有形如 `[ALL_CAPS_IDENTIFIER]` 的占位符。
   **重要**：用户可能需要比模板中更多或更少的原则。如果指定了数量，请遵循通用模板并据此更新文档。

2. 为占位符收集/推导值：
   - 若用户输入（对话）提供了值，直接使用。
   - 否则从仓库上下文推断（README、文档、已有宪法版本如内嵌）。
   - 治理日期：`RATIFICATION_DATE` 为首次通过日期（未知则询问或标记 TODO），`LAST_AMENDED_DATE` 在有改动时取今天，否则保留原值。
   - `CONSTITUTION_VERSION` 必须遵循语义版本规则递增：
     - MAJOR：不向后兼容的治理/原则移除或重定义。
     - MINOR：新增原则/章节或显著扩展指导。
     - PATCH：澄清、措辞、错别字修复、非语义性细化。
   - 若版本升级类型不明确，先给出理由再定稿。

3. 起草更新后的宪法内容：
   - 替换所有占位符为具体文本（不留方括号令牌，除非项目明确选择保留，并需说明理由）。
   - 保持标题层级；注释在替换后可移除，除非仍需说明。
   - 每条原则包含：简洁名称行、不可协商规则段落（或列表）、若非显然则给出明确理由。
   - 治理章节需列明修订流程、版本策略、合规审查期望。

4. 一致性传播清单（将原清单转换为主动验证）：
   - 阅读 `.specify/templates/plan-template.md`，确保其中“Constitution Check”或规则与更新后的原则一致。
   - 阅读 `.specify/templates/spec-template.md` 对齐范围/需求；若宪法增删强制章节或约束，需更新。
   - 阅读 `.specify/templates/tasks-template.md`，确保任务分类反映新增/移除的原则驱动任务类型（如可观测性、版本化、测试纪律）。
   - 阅读 `.specify/templates/commands/*.md` 中每个命令文件（包括本文件），确保无过时引用（如仅适用于特定代理名的指引）。
   - 阅读运行时指引文档（如 `README.md`、`docs/quickstart.md` 或代理指引文件），更新对原则变更的引用。

5. 生成同步影响报告（更新后以 HTML 注释放在宪法文件顶部）：
   - 版本变更：旧 → 新
   - 修改的原则列表（如重命名，旧标题 → 新标题）
   - 新增章节
   - 删除章节
   - 需要更新的模板（✅ 已更新 / ⚠ 待更新）与文件路径
   - 若有刻意延后的占位符，在此列出后续 TODO

6. 输出前验证：
   - 不保留未解释的方括号令牌。
   - 版本行与报告一致。
   - 日期采用 ISO 格式 YYYY-MM-DD。
   - 原则陈述应明确、可测试、无含糊用语（必要时用 MUST/SHOULD 并给出理由）。

7. 将完整宪法写回 `.specify/memory/constitution.md`（覆盖）。

8. 最终向用户汇报：
   - 新版本及升级理由。
   - 需要人工跟进的文件。
   - 建议提交信息（如 `docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式与风格要求：

- 使用模板中的 Markdown 标题层级（不要升降级）。
- 理由段落尽量在 <100 字符内换行以便阅读，但不要为了凑行而生硬断句。
- 各段之间保持单个空行。
- 避免行尾空白。

如果用户仅提供部分更新（如仅修改一条原则），仍需执行验证与版本决策。

若关键信息缺失（如确认日期未知），插入 `TODO(<FIELD_NAME>): 说明`，并在同步影响报告中列为延后事项。

不要创建新模板；始终操作现有 `.specify/memory/constitution.md`。
